<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Basketball Mini-Game with Animated Stickman</title>
<style>
  body {
    margin: 0; background: #0b1220; color: #e6eef8;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;
  }
  canvas {
    background: linear-gradient(180deg, #0b2b1f, #06321f);
    border-radius: 8px;
    width: 900px;
    height: 520px;
    display: block;
  }
  .hud {
    margin: 10px;
    font-size: 18px;
    display: flex;
    gap: 20px;
  }
  button {
    background: #ff6b35; border: none; color: #08121a;
    padding: 8px 16px; border-radius: 8px; font-weight: 700; cursor: pointer;
  }
</style>
</head>
<body>
  <div class="hud">
    <div id="score">Score: 0</div>
    <div id="timer">Time: 60s</div>
    <button id="startBtn">Start</button>
  </div>
  <canvas id="game"></canvas>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const DPR = window.devicePixelRatio || 1;

  // Resize canvas
  function resize() {
    canvas.width = canvas.clientWidth * DPR;
    canvas.height = canvas.clientHeight * DPR;
  }
  resize();
  window.addEventListener('resize', () => {
    resize();
    draw();
  });

  // Game vars
  let running = false;
  let score = 0;
  let timeLeft = 60;
  let timerInterval = null;

  // Player stickman position & animation state
  const player = {
    x: 100 * DPR,
    y: canvas.height / 1.3,
    speed: 5 * DPR,
    vx: 0,
    vy: 0,
    moving: false,
    animFrame: 0,
    animSpeed: 0.15,
    facingRight: true,
    shooting: false,
  };

  // Ball
  const ball = {
    x: player.x,
    y: player.y - 60 * DPR,
    r: 12 * DPR,
    vx: 0,
    vy: 0,
    flying: false,
  };

  // Hoop
  const hoop = {
    x: canvas.width - 150 * DPR,
    y: canvas.height / 2,
    w: 80 * DPR,
    h: 60 * DPR,
    rimY: null,
  };
  hoop.rimY = hoop.y + hoop.h * 0.25;

  // Controls state
  const keys = {};

  window.addEventListener('keydown', (e) => {
    keys[e.key.toLowerCase()] = true;

    if(e.key === ' ' && running && !ball.flying) {
      shootBall();
    }
  });

  window.addEventListener('keyup', (e) => {
    keys[e.key.toLowerCase()] = false;
  });

  function shootBall() {
    if (ball.flying) return;
    player.shooting = true;
    ball.flying = true;
    // Shoot ball towards hoop rim with arc
    const dx = hoop.x + hoop.w * 0.5 - ball.x;
    const dy = hoop.rimY - ball.y;
    const speedFactor = 0.15 * DPR;
    ball.vx = dx * speedFactor;
    ball.vy = dy * speedFactor - 6 * DPR;
  }

  function updatePlayer() {
    player.vx = 0;
    player.vy = 0;
    player.moving = false;

    if(keys['w']) { player.vy = -player.speed; player.moving = true; }
    if(keys['s']) { player.vy = player.speed; player.moving = true; }
    if(keys['a']) { player.vx = -player.speed; player.moving = true; player.facingRight = false; }
    if(keys['d']) { player.vx = player.speed; player.moving = true; player.facingRight = true; }

    player.x += player.vx;
    player.y += player.vy;

    // Clamp inside canvas
    player.x = Math.min(Math.max(40 * DPR, player.x), canvas.width - 40 * DPR);
    player.y = Math.min(Math.max(120 * DPR, player.y), canvas.height - 40 * DPR);

    // Ball follows player if not flying
    if(!ball.flying) {
      ball.x = player.x + (player.facingRight ? 20 * DPR : -20 * DPR);
      ball.y = player.y - 60 * DPR;
    }

    // Animate walking
    if(player.moving && !player.shooting) {
      player.animFrame += player.animSpeed;
      if(player.animFrame > 3) player.animFrame = 0;
    } else {
      player.animFrame = 0;
    }
  }

  function updateBall() {
    if(ball.flying) {
      // Gravity
      ball.vy += 0.3 * DPR;
      ball.x += ball.vx;
      ball.y += ball.vy;

      // Bounce floor
      if(ball.y + ball.r > canvas.height) {
        ball.y = canvas.height - ball.r;
        ball.vy *= -0.4;
        ball.vx *= 0.6;
      }

      // Check scoring: ball passes rim downward within rim horizontal range
      if(ball.x > hoop.x && ball.x < hoop.x + hoop.w &&
         ball.y > hoop.rimY - 10 * DPR && ball.y < hoop.rimY + 10 * DPR &&
         ball.vy > 0) {
        score++;
        document.getElementById('score').textContent = 'Score: ' + score;
        resetBallAndPlayer();
      }

      // Reset ball if almost stopped
      if(Math.abs(ball.vx) < 0.5 && Math.abs(ball.vy) < 0.5 && ball.y + ball.r >= canvas.height) {
        resetBallAndPlayer();
      }
    }
  }

  function resetBallAndPlayer() {
    ball.flying = false;
    player.shooting = false;
    ball.vx = 0;
    ball.vy = 0;
    ball.x = player.x + (player.facingRight ? 20 * DPR : -20 * DPR);
    ball.y = player.y - 60 * DPR;
  }

  // Draw stickman parts with simple animation frames
  function drawPlayer() {
    ctx.save();
    ctx.translate(player.x, player.y);
    if(!player.facingRight) ctx.scale(-1,1);

    // Body
    ctx.strokeStyle = '#ff6b35';
    ctx.lineWidth = 8 * DPR;
    ctx.lineCap = 'round';

    // Head
    ctx.beginPath();
    ctx.arc(0, -60 * DPR, 15 * DPR, 0, Math.PI * 2);
    ctx.fillStyle = '#ff6b35';
    ctx.fill();
    ctx.stroke();

    // Body line
    ctx.beginPath();
    ctx.moveTo(0, -45 * DPR);
    ctx.lineTo(0, 0);
    ctx.stroke();

    // Arms animation: swing back and forth (walking) or shooting pose
    ctx.beginPath();
    if(player.shooting) {
      // Shooting: right arm forward, left arm back
      ctx.moveTo(0, -40 * DPR);
      ctx.lineTo(25 * DPR, -55 * DPR); // shooting arm
      ctx.moveTo(0, -40 * DPR);
      ctx.lineTo(-20 * DPR, -55 * DPR);
    } else {
      // Walking arms swing with animFrame (0 to 3)
      const swing = Math.sin(player.animFrame * Math.PI * 2) * 15 * DPR;
      ctx.moveTo(0, -40 * DPR);
      ctx.lineTo(20 * DPR, -40 * DPR + swing);
      ctx.moveTo(0, -40 * DPR);
      ctx.lineTo(-20 * DPR, -40 * DPR - swing);
    }
    ctx.stroke();

    // Legs animation: swing with animFrame
    ctx.beginPath();
    const legSwing = Math.sin(player.animFrame * Math.PI * 2) * 20 * DPR;
    ctx.moveTo(0, 0);
    ctx.lineTo(15 * DPR, legSwing);
    ctx.moveTo(0, 0);
    ctx.lineTo(-15 * DPR, -legSwing);
    ctx.stroke();

    ctx.restore();
  }

  function drawBall() {
    ctx.save();
    ctx.fillStyle = '#ff9f1c';
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
    ctx.fill();

    ctx.strokeStyle = '#b35914';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(ball.x - ball.r * 0.6, ball.y);
    ctx.quadraticCurveTo(ball.x, ball.y + ball.r * 0.6, ball.x + ball.r * 0.6, ball.y);
    ctx.stroke();

    ctx.restore();
  }

  function drawHoop() {
    ctx.save();

    // Backboard
    const bw = hoop.w * 0.25;
    const bh = hoop.h * 0.22;
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    ctx.fillRect(hoop.x - bw - 8, hoop.y - bh / 2, bw, bh);

    // Rim
    ctx.beginPath();
    ctx.lineWidth = 6;
    ctx.strokeStyle = '#ff6b35';
    ctx.arc(hoop.x + hoop.w * 0.12, hoop.rimY, hoop.w * 0.22, 0, Math.PI * 2);
    ctx.stroke();

    ctx.restore();
  }

  function drawCourt() {
    const W = canvas.width;
    const H = canvas.height;

    // floor gradient
    const g = ctx.createLinearGradient(0, H * 0.6, 0, H);
    g.addColorStop(0, 'rgba(0,0,0,0.05)');
    g.addColorStop(1, 'rgba(0,0,0,0.25)');
    ctx.fillStyle = g;
    ctx.fillRect(0, H * 0.6, W, H * 0.4);

    // center line
    ctx.strokeStyle = 'rgba(255,255,255,0.06)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(W * 0.5, H * 0.6);
    ctx.lineTo(W * 0.5, H);
    ctx.stroke();
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // background
    const bg = ctx.createLinearGradient(0, 0, 0, canvas.height);
    bg.addColorStop(0, '#072938');
    bg.addColorStop(1, '#0b2b1f');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    drawCourt();
    drawHoop();
    drawPlayer();
    drawBall();

    if(running) {
      updatePlayer();
      updateBall();
    }

    requestAnimationFrame(draw);
  }

  function startGame() {
    if(running) return;
    running = true;
    score = 0;
    timeLeft = 60;
    document.getElementById('score').textContent = 'Score: 0';
    document.getElementById('timer').textContent = 'Time: 60s';
    resetBallAndPlayer();

    timerInterval = setInterval(() => {
      timeLeft--;
      document.getElementById('timer').textContent = `Time: ${timeLeft}s`;
      if(timeLeft <= 0) {
        running = false;
        clearInterval(timerInterval);
        alert(`Time's up! Your score: ${score}`);
      }
    }, 1000);
  }

  document.getElementById('startBtn').addEventListener('click', () => {
    if(running) {
      running = false;
      clearInterval(timerInterval);
      document.getElementById('startBtn').textContent = 'Start';
    } else {
      startGame();
      document.getElementById('startBtn').textContent = 'Stop';
    }
  });

  draw();
})();
</script>
</body>
</html>
